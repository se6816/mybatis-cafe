<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
 <mapper namespace="com.test.Mapper.FileMapper">
 	<!-- 파일 임시 등록 -->
 	<insert id="upload" parameterType="map">
 		insert into ${boardType.DB_File_Table}
 		(PATHNAME,FILENAME,ORIGINAL_FILENAME,FILESIZE,
 		CONTENT_TYPE,RESOURCE_PATHNAME)
		values 
		(#{file.PathName}, #{file.FileName}, #{file.Original_Filename},
		 #{file.FileSize},#{file.Content_Type},
		 #{file.ReSource_PathName})
		<selectKey keyProperty="file.FILEID" resultType="Integer" order="AFTER">
			select IFNULL(MAX(FILEID),0) from
			${boardType.DB_File_Table}
		</selectKey>
 	</insert>
 	<!-- 파일 찾기 -->
 	<select id="searchFile" parameterType="map" resultType="com.test.domain.FileVO">
 		select PATHNAME,FILENAME, CONTENT_TYPE,FILESIZE
 		from
 		${boardType.DB_File_Table}
 		where
 		 FILEID=#{fid}
 	</select>
 	<!-- 파일 조회 -->
 	<select id="selectFile" parameterType="map" resultType="com.test.domain.FileVO">
 		select RESOURCE_PATHNAME, FILEID
 		from
 		${boardType.DB_File_Table}
 		where
 		 FILEID=#{fid}
 	</select>
 	<!-- 파일 정상 등록 -->
 	<update id="registerBidAll" parameterType="map">
 		update 
		${boardType.DB_File_Table}
		set bid=#{bid}
		where bid is null
		and FILEID in 
		<foreach collection="fid" item="num"
			open="(" separator="," close=")">
				#{num}
		</foreach>
 	</update>
 	<!-- 불필요 파일 삭제 -->
 	<delete id="deleteFileAll" parameterType="map">
 		update 
 			${boardType.DB_File_Table}
 		set bid=null
 		where FILEID in
 		<foreach collection="fid" item="num"
			open="(" separator="," close=")">
				#{num}
		</foreach>
 	</delete>
 	<!-- 파일이 존재하는가 -->
 	<select id="findContainedFile" parameterType="map" resultType="int">
 		select FILEID
 		from 
 		${boardType.DB_File_Table}
 		where bid=#{bid}
 	</select>
 	
 </mapper>