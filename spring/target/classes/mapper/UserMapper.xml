<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

  
  <mapper namespace="com.cafe.classic.Mapper.UserMapper">
  	
  	<resultMap type="UserVO" id="user">
  		<result column="id" property="id"/>
  		<result column="password" property="password"/>
  		<result column="username" property="username"/>
  		<result column="email" property="email"/>
  		<result column="role" property="role" 
  			typeHandler="EnumTypeHandler"/>
  	</resultMap>
  	<resultMap type="ReportVO" id="report">
  		<result column="id" property="id"/>
  		<result column="bid" property="bid"/>
  		<result column="content" property="content"/>
  		<result column="reportType" property="reportType" 
  			typeHandler="EnumTypeHandler"/>
  	</resultMap>
  	<!-- 유저 email을 이용한 조회 -->
  	<select id="selectMemberFromEmail" resultType="UserVO">
  		select *
  		from
  			user
  		where
  		    email=#{email};
  	</select>
  	<!-- 유저 id를 이용한 조회 -->
  	<select id="selectMember" resultMap="user">
  		select *
  		from
  			user
  		where
  		    id=#{id};
  		    
  	</select> 	
  	<!-- 닉네임 중복 여부 -->
  	<select id="isUserName" resultType="integer">
  	 select count(*)
  	 	from 
  	 		user
  	 	where
  	 		username=#{username}
  	</select>
  	<!-- ID 중복 여부 -->
  	<select id="isID" resultType="integer">
  	select count(*)
  		from 
  			user
  		where
  			id=#{id}
  	</select>
  	<!-- Email 중복 여부 -->
  	<select id="isEmail" resultType="integer">
  	select count(*)
  		from 
  			user
  		where
  			email=#{email}
  	</select>
  	
  	<!--회원가입 -->
  	<insert id="insertMember">
  		insert into user (id, password, username, email, role) values
  		(#{id},#{password},#{username},#{email}, 
  		#{role, typeHandler=EnumTypeHandler})
  	</insert>
  	<!--회원탈퇴 -->
  	<delete id="deleteMember">
  		delete
  		from user
  		where id=#{id}
  	</delete>
  	
  	<!-- 신고 기능 -->
  	<insert id="reportAdmin" parameterType="map">
  		insert into report(id, bid, content, reportType, boardType)
  		values(#{id},#{bid},#{content},#{reportType,typeHandler=EnumTypeHandler},
  		#{boardType,typeHandler=EnumTypeHandler})
  		on duplicate key update
  		content=#{content},
  		reportType=#{reportType,typeHandler=EnumTypeHandler}
  	</insert>
  	<!-- 비밀번호 변경 -->
  	<update id="UpdatePassword">
  	update 
		user
		set password=#{password}
		where id=#{id}
  	</update>
 	
 	
 	
  </mapper>
  